# ğŸ›¡ï¸ ç¡¬ç¼–ç é¢„é˜²å’Œè§£å†³æœºåˆ¶å®Œæ•´æ–¹æ¡ˆ

åŸºäºå¯¹é¡¹ç›®å›½é™…åŒ–ç¡¬ç¼–ç ä¿®å¤æ–‡æ¡£çš„æ·±å…¥å­¦ä¹ å’Œåˆ†æï¼Œåˆ¶å®šè¿™å¥—å®Œæ•´çš„ç¡¬ç¼–ç é¢„é˜²å’Œè§£å†³æœºåˆ¶ã€‚

## ğŸ“Š é—®é¢˜ç°çŠ¶åˆ†æ

### å·²è§£å†³çš„é—®é¢˜
- âœ… é…ç½®å†²çªï¼šnext-intl APIç‰ˆæœ¬å†²çªå·²ä¿®å¤
- âœ… è·¯å¾„é”™è¯¯ï¼šé…ç½®æ–‡ä»¶è·¯å¾„é—®é¢˜å·²è§£å†³
- âœ… æ„å»ºè­¦å‘Šï¼šæŠ€æœ¯é…ç½®å±‚é¢é—®é¢˜å·²æ¸…ç†

### å½“å‰æ ¸å¿ƒé—®é¢˜
- âŒ **ç¡¬ç¼–ç æ–‡æœ¬**ï¼š2000+å¤„ç¡¬ç¼–ç å­—ç¬¦ä¸²æ•£å¸ƒåœ¨ä»£ç ä¸­
- âŒ **ç¿»è¯‘é”®ç¼ºå¤±**ï¼šå¤§é‡ç¡¬ç¼–ç æ–‡æœ¬ç¼ºå°‘å¯¹åº”çš„ç¿»è¯‘é”®
- âŒ **æ¶æ„ä¸å®Œæ•´**ï¼šç¼ºä¹ç³»ç»Ÿæ€§çš„å›½é™…åŒ–æ¶æ„è®¾è®¡
- âŒ **æµç¨‹ç¼ºå¤±**ï¼šæ²¡æœ‰ç¡¬ç¼–ç é¢„é˜²å’Œæ£€æµ‹æœºåˆ¶

## ğŸ¯ è§£å†³æ–¹æ¡ˆæ¶æ„

### ä¸‰å±‚é˜²æŠ¤ä½“ç³»

#### ç¬¬ä¸€å±‚ï¼šé¢„é˜²æœºåˆ¶ï¼ˆPreventionï¼‰
- å¼€å‘è§„èŒƒåˆ¶å®š
- æ¨¡æ¿å’Œå·¥å…·æ”¯æŒ
- ä»£ç å®¡æŸ¥æµç¨‹

#### ç¬¬äºŒå±‚ï¼šæ£€æµ‹æœºåˆ¶ï¼ˆDetectionï¼‰
- è‡ªåŠ¨åŒ–æ£€æµ‹å·¥å…·
- CI/CDé›†æˆæ£€æŸ¥
- å®æ—¶ç›‘æ§ç³»ç»Ÿ

#### ç¬¬ä¸‰å±‚ï¼šä¿®å¤æœºåˆ¶ï¼ˆResolutionï¼‰
- æ™ºèƒ½ä¿®å¤å·¥å…·
- æ‰¹é‡å¤„ç†ç­–ç•¥
- è´¨é‡éªŒè¯æµç¨‹

## ğŸ› ï¸ å…·ä½“å®æ–½æ–¹æ¡ˆ

### Phase 1: é¢„é˜²æœºåˆ¶å»ºè®¾ï¼ˆ1å‘¨ï¼‰

#### 1.1 å¼€å‘è§„èŒƒåˆ¶å®š

**ç¿»è¯‘é”®å‘½åè§„èŒƒ**
```typescript
// æ ‡å‡†å‘½åç»“æ„
const namingConventions = {
  // é¡µé¢çº§ï¼špages.[pageName].[section].[item]
  pages: {
    naturalTherapies: 'pages.naturalTherapies.hero.title',
    healthGuide: 'pages.healthGuide.sections.pain.title'
  },
  
  // ç»„ä»¶çº§ï¼šcomponents.[componentName].[element]
  components: {
    button: 'components.button.submit',
    modal: 'components.modal.title'
  },
  
  // é€šç”¨çº§ï¼šcommon.[category].[item]
  common: {
    actions: 'common.actions.save',
    messages: 'common.messages.loading'
  },
  
  // åŒ»å­¦çº§ï¼šmedical.[category].[term]
  medical: {
    symptoms: 'medical.symptoms.cramping',
    treatments: 'medical.treatments.heatTherapy'
  }
};
```

**ç¡¬ç¼–ç ç¦æ­¢è§„åˆ™**
```typescript
// ä¸¥æ ¼ç¦æ­¢çš„ç¡¬ç¼–ç æ¨¡å¼
const forbiddenPatterns = [
  // æ¡ä»¶ç¡¬ç¼–ç 
  /locale === 'zh' \? '([^']+)' : '([^']+)'/g,
  /locale === 'zh' \? "([^"]+)" : "([^"]+)"/g,
  
  // ç›´æ¥å­—ç¬¦ä¸²ç¡¬ç¼–ç 
  /'[\u4e00-\u9fff]+'/g,  // ä¸­æ–‡å­—ç¬¦ä¸²
  /"[\\u4e00-\\u9fff]+"/g,  // ä¸­æ–‡å­—ç¬¦ä¸²
  
  // ç§‘å­¦å‚æ•°ç¡¬ç¼–ç 
  /temperature.*[0-9]+.*Â°[CF]/g,
  /duration.*[0-9]+.*minute/g,
  /dosage.*[0-9]+.*mg/g
];
```

#### 1.2 å¼€å‘å·¥å…·æ”¯æŒ

**é¡µé¢æ¨¡æ¿ç”Ÿæˆå™¨**
```typescript
// è‡ªåŠ¨ç”Ÿæˆå›½é™…åŒ–é¡µé¢æ¨¡æ¿
const createI18nPageTemplate = (pageName: string) => {
  return {
    // é¡µé¢å…ƒæ•°æ®æ¨¡æ¿
    metadata: {
      title: `{{${pageName}.meta.title}}`,
      description: `{{${pageName}.meta.description}}`,
      keywords: `{{${pageName}.meta.keywords}}`
    },
    
    // é¡µé¢å†…å®¹æ¨¡æ¿
    content: {
      hero: {
        title: `{{${pageName}.hero.title}}`,
        subtitle: `{{${pageName}.hero.subtitle}}`,
        description: `{{${pageName}.hero.description}}`
      },
      
      sections: {
        // åŠ¨æ€sectionæ¨¡æ¿
        [sectionName]: {
          title: `{{${pageName}.sections.${sectionName}.title}}`,
          description: `{{${pageName}.sections.${sectionName}.description}}`
        }
      }
    }
  };
};
```

**ç»„ä»¶æ¨¡æ¿ç”Ÿæˆå™¨**
```typescript
// è‡ªåŠ¨ç”Ÿæˆå›½é™…åŒ–ç»„ä»¶æ¨¡æ¿
const createI18nComponentTemplate = (componentName: string, props: string[]) => {
  const template = {};
  props.forEach(prop => {
    template[prop] = `{{${componentName}.${prop}}}`;
  });
  return template;
};
```

#### 1.3 ä»£ç å®¡æŸ¥æµç¨‹

**Pre-commit Hook**
```bash
#!/bin/bash
# .git/hooks/pre-commit

echo "ğŸ” æ£€æŸ¥ç¡¬ç¼–ç ..."

# è¿è¡Œç¡¬ç¼–ç æ£€æµ‹
if ! node scripts/detect-hardcoded-urls.js; then
    echo "âŒ å‘ç°ç¡¬ç¼–ç URLï¼Œæäº¤è¢«é˜»æ­¢"
    exit 1
fi

if ! node scripts/detect-hardcoded-text.js; then
    echo "âŒ å‘ç°ç¡¬ç¼–ç æ–‡æœ¬ï¼Œæäº¤è¢«é˜»æ­¢"
    exit 1
fi

echo "âœ… ç¡¬ç¼–ç æ£€æŸ¥é€šè¿‡"
exit 0
```

### Phase 2: æ£€æµ‹æœºåˆ¶å»ºè®¾ï¼ˆ1å‘¨ï¼‰

#### 2.1 æ™ºèƒ½æ£€æµ‹å·¥å…·

**ç¡¬ç¼–ç æ–‡æœ¬æ£€æµ‹å™¨**
```typescript
class HardcodedTextDetector {
  private patterns = [
    // æ¡ä»¶ç¡¬ç¼–ç æ¨¡å¼
    /locale === 'zh' \? '([^']+)' : '([^']+)'/g,
    /locale === 'zh' \? "([^"]+)" : "([^"]+)"/g,
    
    // ç›´æ¥ä¸­æ–‡å­—ç¬¦ä¸²
    /'[\u4e00-\u9fff]+'/g,
    /"[\u4e00-\u9fff]+"/g,
    
    // ç§‘å­¦å‚æ•°ç¡¬ç¼–ç 
    /temperature.*[0-9]+.*Â°[CF]/g,
    /duration.*[0-9]+.*minute/g,
    /dosage.*[0-9]+.*mg/g
  ];
  
  // æ£€æµ‹å•ä¸ªæ–‡ä»¶
  detectInFile(filePath: string): HardcodeReport[] {
    const content = fs.readFileSync(filePath, 'utf-8');
    const reports: HardcodeReport[] = [];
    
    this.patterns.forEach(pattern => {
      const matches = content.matchAll(pattern);
      for (const match of matches) {
        reports.push({
          file: filePath,
          line: this.getLineNumber(content, match.index!),
          match: match[0],
          type: this.classifyHardcode(match[0]),
          suggestion: this.generateSuggestion(match)
        });
      }
    });
    
    return reports;
  }
  
  // åˆ†ç±»ç¡¬ç¼–ç ç±»å‹
  private classifyHardcode(text: string): HardcodeType {
    if (text.includes('locale ===')) return 'conditional';
    if (/[\u4e00-\u9fff]/.test(text)) return 'chinese-text';
    if (/[0-9]+.*Â°[CF]/.test(text)) return 'scientific-param';
    return 'other';
  }
  
  // ç”Ÿæˆä¿®å¤å»ºè®®
  private generateSuggestion(match: RegExpMatchArray): string {
    const [fullMatch, zhText, enText] = match;
    const keySuggestion = this.generateKeySuggestion(zhText);
    return `å»ºè®®æ›¿æ¢ä¸º: t('${keySuggestion}')`;
  }
}
```

**ç¿»è¯‘é”®å®Œæ•´æ€§æ£€æŸ¥å™¨**
```typescript
class TranslationKeyChecker {
  // æ£€æŸ¥ç¿»è¯‘é”®æ˜¯å¦å®Œæ•´
  checkCompleteness(): CompletenessReport {
    const usedKeys = this.extractUsedKeys();
    const availableKeys = this.extractAvailableKeys();
    
    const missingKeys = usedKeys.filter(key => !availableKeys.includes(key));
    const unusedKeys = availableKeys.filter(key => !usedKeys.includes(key));
    
    return {
      totalUsed: usedKeys.length,
      totalAvailable: availableKeys.length,
      missingKeys,
      unusedKeys,
      completeness: (usedKeys.length - missingKeys.length) / usedKeys.length
    };
  }
  
  // æ£€æŸ¥ç¿»è¯‘é”®ç»“æ„
  checkStructure(): StructureReport {
    const structureIssues: string[] = [];
    
    // æ£€æŸ¥å‘½åè§„èŒƒ
    const namingIssues = this.checkNamingConventions();
    structureIssues.push(...namingIssues);
    
    // æ£€æŸ¥åµŒå¥—æ·±åº¦
    const depthIssues = this.checkNestingDepth();
    structureIssues.push(...depthIssues);
    
    return {
      issues: structureIssues,
      score: this.calculateStructureScore(structureIssues)
    };
  }
}
```

#### 2.2 å®æ—¶ç›‘æ§ç³»ç»Ÿ

**å¼€å‘ç¯å¢ƒç›‘æ§**
```typescript
// æ–‡ä»¶ç›‘å¬å™¨
class FileWatcher {
  private watcher: chokidar.FSWatcher;
  
  constructor() {
    this.watcher = chokidar.watch('app/**/*.{tsx,ts}', {
      ignored: /node_modules/,
      persistent: true
    });
    
    this.watcher.on('change', (path) => {
      this.checkFileForHardcode(path);
    });
  }
  
  private async checkFileForHardcode(filePath: string) {
    const detector = new HardcodedTextDetector();
    const reports = detector.detectInFile(filePath);
    
    if (reports.length > 0) {
      console.warn(`âš ï¸ å‘ç°ç¡¬ç¼–ç : ${filePath}`);
      reports.forEach(report => {
        console.warn(`  ç¬¬${report.line}è¡Œ: ${report.match}`);
        console.warn(`  å»ºè®®: ${report.suggestion}`);
      });
    }
  }
}
```

### Phase 3: ä¿®å¤æœºåˆ¶å»ºè®¾ï¼ˆ2å‘¨ï¼‰

#### 3.1 æ™ºèƒ½ä¿®å¤å·¥å…·

**å®‰å…¨ä¿®å¤è„šæœ¬**
```typescript
class SafeHardcodeFixer {
  // ä¿®å¤å•ä¸ªæ–‡ä»¶
  async fixFile(filePath: string): Promise<FixResult> {
    const content = fs.readFileSync(filePath, 'utf-8');
    let newContent = content;
    let hasChanges = false;
    
    // å¤‡ä»½åŸæ–‡ä»¶
    fs.writeFileSync(`${filePath}.backup`, content);
    
    // åº”ç”¨ä¿®å¤è§„åˆ™
    const fixRules = this.getFixRules();
    for (const rule of fixRules) {
      const matches = newContent.match(rule.pattern);
      if (matches) {
        newContent = newContent.replace(rule.pattern, rule.replacement);
        hasChanges = true;
      }
    }
    
    if (hasChanges) {
      // æ·»åŠ å¿…è¦çš„å¯¼å…¥
      if (!newContent.includes('useTranslations')) {
        newContent = this.addTranslationImport(newContent);
      }
      
      // å†™å…¥ä¿®å¤åçš„å†…å®¹
      fs.writeFileSync(filePath, newContent);
      
      return {
        success: true,
        changes: hasChanges,
        backup: `${filePath}.backup`
      };
    }
    
    return { success: true, changes: false };
  }
  
  // è·å–ä¿®å¤è§„åˆ™
  private getFixRules() {
    return [
      {
        pattern: /locale === 'zh' \? '([^']+)' : '([^']+)'/g,
        replacement: "t('$1')",
        type: 'conditional-string'
      },
      {
        pattern: /'([\u4e00-\u9fff]+)'/g,
        replacement: "t('$1')",
        type: 'chinese-string'
      }
    ];
  }
}
```

#### 3.2 æ‰¹é‡å¤„ç†ç­–ç•¥

**åˆ†é˜¶æ®µæ‰¹é‡ä¿®å¤**
```typescript
class BatchProcessor {
  // æŒ‰ä¼˜å…ˆçº§å¤„ç†æ–‡ä»¶
  async processByPriority(): Promise<void> {
    const files = this.getFilesByPriority();
    
    for (const file of files) {
      console.log(`å¤„ç†æ–‡ä»¶: ${file.path}`);
      
      try {
        const result = await this.fixFile(file.path);
        if (result.success) {
          console.log(`âœ… ä¿®å¤æˆåŠŸ: ${file.path}`);
        } else {
          console.log(`âŒ ä¿®å¤å¤±è´¥: ${file.path}`);
        }
      } catch (error) {
        console.error(`âŒ å¤„ç†é”™è¯¯: ${file.path}`, error);
      }
    }
  }
  
  // è·å–æŒ‰ä¼˜å…ˆçº§æ’åºçš„æ–‡ä»¶
  private getFilesByPriority() {
    return [
      // P0: ç”¨æˆ·å½±å“æœ€å¤§çš„é¡µé¢
      { path: 'app/natural-therapies/page.tsx', priority: 0, hardcodeCount: 304 },
      { path: 'app/health-guide/understanding-pain/page.tsx', priority: 0, hardcodeCount: 154 },
      
      // P1: ä¸­ç­‰å½±å“çš„é¡µé¢
      { path: 'app/scenario-solutions/commute/page.tsx', priority: 1, hardcodeCount: 114 },
      { path: 'app/scenario-solutions/emergency-kit/page.tsx', priority: 1, hardcodeCount: 109 }
    ];
  }
}
```

### Phase 4: è´¨é‡ä¿è¯ï¼ˆ1å‘¨ï¼‰

#### 4.1 å…¨é¢æµ‹è¯•éªŒè¯

**å¤šè¯­è¨€æµ‹è¯•å¥—ä»¶**
```typescript
describe('å›½é™…åŒ–æµ‹è¯•', () => {
  test('æ‰€æœ‰é¡µé¢æ”¯æŒä¸­è‹±æ–‡åˆ‡æ¢', async () => {
    const pages = ['/zh', '/en', '/zh/natural-therapies', '/en/natural-therapies'];
    
    for (const page of pages) {
      const response = await fetch(`http://localhost:3000${page}`);
      expect(response.status).toBe(200);
      
      const html = await response.text();
      expect(html).not.toMatch(/locale === 'zh'/);
      expect(html).not.toMatch(/[\u4e00-\u9fff].*[\u4e00-\u9fff]/);
    }
  });
  
  test('ç¿»è¯‘é”®å®Œæ•´æ€§', () => {
    const checker = new TranslationKeyChecker();
    const report = checker.checkCompleteness();
    
    expect(report.completeness).toBeGreaterThan(0.95);
    expect(report.missingKeys).toHaveLength(0);
  });
});
```

#### 4.2 æŒç»­ç›‘æ§æœºåˆ¶

**CI/CDé›†æˆ**
```yaml
# .github/workflows/i18n-check.yml
name: å›½é™…åŒ–æ£€æŸ¥

on: [push, pull_request]

jobs:
  i18n-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: å®‰è£…ä¾èµ–
        run: npm install
      
      - name: æ£€æŸ¥ç¡¬ç¼–ç 
        run: node scripts/detect-hardcoded-text.js
      
      - name: æ£€æŸ¥ç¿»è¯‘é”®å®Œæ•´æ€§
        run: node scripts/check-translation-keys.js
      
      - name: æ„å»ºæµ‹è¯•
        run: npm run build
```

## ğŸ“‹ å®æ–½æ—¶é—´è¡¨

### Week 1: é¢„é˜²æœºåˆ¶å»ºè®¾
- [ ] åˆ¶å®šå¼€å‘è§„èŒƒå’Œå‘½åæ ‡å‡†
- [ ] åˆ›å»ºé¡µé¢å’Œç»„ä»¶æ¨¡æ¿ç”Ÿæˆå™¨
- [ ] è®¾ç½®Pre-commit Hook
- [ ] å»ºç«‹ä»£ç å®¡æŸ¥æµç¨‹

### Week 2: æ£€æµ‹æœºåˆ¶å»ºè®¾
- [ ] å¼€å‘æ™ºèƒ½æ£€æµ‹å·¥å…·
- [ ] å®ç°å®æ—¶ç›‘æ§ç³»ç»Ÿ
- [ ] é›†æˆCI/CDæ£€æŸ¥
- [ ] å»ºç«‹æŠ¥å‘Šç”Ÿæˆæœºåˆ¶

### Week 3-4: ä¿®å¤æœºåˆ¶å»ºè®¾
- [ ] å¼€å‘å®‰å…¨ä¿®å¤å·¥å…·
- [ ] å®æ–½åˆ†é˜¶æ®µæ‰¹é‡ä¿®å¤
- [ ] å»ºç«‹è´¨é‡éªŒè¯æµç¨‹
- [ ] å®Œå–„å›æ»šæœºåˆ¶

### Week 5: è´¨é‡ä¿è¯
- [ ] å…¨é¢æµ‹è¯•éªŒè¯
- [ ] æ€§èƒ½å½±å“è¯„ä¼°
- [ ] ç”¨æˆ·ä½“éªŒæµ‹è¯•
- [ ] æ–‡æ¡£å’ŒåŸ¹è®­

## ğŸ¯ é¢„æœŸæ•ˆæœ

### é‡åŒ–æŒ‡æ ‡
- **ç¡¬ç¼–ç æ•°é‡**: 2000+ â†’ 0
- **ç¿»è¯‘é”®å®Œæ•´æ€§**: 60% â†’ 95%+
- **é¡µé¢åŠ è½½é€Ÿåº¦**: æå‡15-20%
- **ç»´æŠ¤æˆæœ¬**: é™ä½60-70%
- **æ–°è¯­è¨€æ”¯æŒæ—¶é—´**: 2å‘¨ â†’ 2å¤©

### è´¨é‡æå‡
- **å®Œå…¨ä¸€è‡´çš„å¤šè¯­è¨€ä½“éªŒ**
- **ä¸“ä¸šå‡†ç¡®çš„åŒ»ç–—æœ¯è¯­ç¿»è¯‘**
- **å“åº”å¼è®¾è®¡å®Œç¾é€‚é…**
- **å¯ç»´æŠ¤çš„ä»£ç æ¶æ„**

## âš ï¸ é£é™©æ§åˆ¶

### æŠ€æœ¯é£é™©
- **æ„å»ºå¤±è´¥**: åˆ†é˜¶æ®µéƒ¨ç½²ï¼Œæ¯æ­¥éªŒè¯
- **æ€§èƒ½å½±å“**: ç›‘æ§bundleå¤§å°å’ŒåŠ è½½æ—¶é—´
- **å…¼å®¹æ€§é—®é¢˜**: ä¿ç•™å›æ»šæœºåˆ¶

### ä¸šåŠ¡é£é™©
- **ç¿»è¯‘å‡†ç¡®æ€§**: åŒ»ç–—å†…å®¹éœ€ä¸“ä¸šå®¡æ ¸
- **ç”¨æˆ·ä½“éªŒ**: æ¸è¿›å¼å‘å¸ƒï¼Œæ”¶é›†åé¦ˆ
- **SEOå½±å“**: ç›‘æ§æœç´¢å¼•æ“ç´¢å¼•æƒ…å†µ

## ğŸš€ æ€»ç»“

è¿™å¥—ç¡¬ç¼–ç é¢„é˜²å’Œè§£å†³æœºåˆ¶åŸºäºé¡¹ç›®å®é™…ç»éªŒï¼Œé‡‡ç”¨ä¸‰å±‚é˜²æŠ¤ä½“ç³»ï¼Œä»é¢„é˜²ã€æ£€æµ‹ã€ä¿®å¤ä¸‰ä¸ªç»´åº¦å…¨é¢è§£å†³ç¡¬ç¼–ç é—®é¢˜ã€‚é€šè¿‡ç³»ç»Ÿæ€§çš„å·¥å…·å»ºè®¾å’Œæµç¨‹ä¼˜åŒ–ï¼Œç¡®ä¿é¡¹ç›®é•¿æœŸçš„å¯ç»´æŠ¤æ€§å’Œå›½é™…åŒ–è´¨é‡ã€‚

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
1. **é¢„é˜²ä¸ºä¸»**ï¼šä»æºå¤´é˜²æ­¢ç¡¬ç¼–ç äº§ç”Ÿ
2. **æ™ºèƒ½æ£€æµ‹**ï¼šè‡ªåŠ¨åŒ–å‘ç°å’Œä¿®å¤é—®é¢˜
3. **è´¨é‡ä¿è¯**ï¼šç¡®ä¿ä¿®å¤è´¨é‡å’Œç”¨æˆ·ä½“éªŒ
4. **æŒç»­æ”¹è¿›**ï¼šå»ºç«‹é•¿æœŸç›‘æ§å’Œä¼˜åŒ–æœºåˆ¶

é€šè¿‡è¿™å¥—æœºåˆ¶ï¼Œé¡¹ç›®å°†å½»åº•è§£å†³ç¡¬ç¼–ç é—®é¢˜ï¼Œå»ºç«‹å¯æŒç»­çš„å›½é™…åŒ–ç®¡ç†ä½“ç³»ã€‚
