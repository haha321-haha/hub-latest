# 🚀 硬编码修复快速开始指南

基于增强版硬编码预防和解决机制，提供快速上手的使用指南。

## 📋 准备工作

### 1. 确认工具已安装
```bash
# 检查工具包是否可用
node scripts/hardcode-prevention-toolkit.js help
node scripts/detect-hardcoded-urls.js --help
```

### 2. 了解当前状态
```bash
# 检测当前硬编码问题
npm run hardcode:all
```

## 🎯 快速修复流程

### Step 1: 检测问题
```bash
# 检测所有类型的硬编码问题
npm run hardcode:all

# 或者分别检测
npm run hardcode:detect          # 检测硬编码URL
npm run hardcode:text:detect     # 检测硬编码文本
npm run hardcode:keys:check      # 检查翻译键完整性
```

### Step 2: 自动修复
```bash
# 自动修复硬编码URL
npm run hardcode:fix

# 验证修复结果
npm run hardcode:verify
```

### Step 3: 验证修复
```bash
# 再次检测确保没有新问题
npm run hardcode:all
```

## 🛠️ 详细使用指南

### 硬编码URL修复

#### 检测硬编码URL
```bash
# 基础检测
node scripts/detect-hardcoded-urls.js

# 增强检测（排除测试文件）
node scripts/detect-hardcoded-urls.js --enhanced --exclude-tests
```

#### 安全修复硬编码URL
```bash
# 自动修复（会创建备份）
node scripts/safe-fix-hardcoded-urls.js

# 修复后验证
node scripts/detect-hardcoded-urls.js
```

### 硬编码文本修复

#### 检测硬编码文本
```bash
# 检测所有硬编码文本
node scripts/hardcode-prevention-toolkit.js detect

# 检测特定文件
node scripts/hardcode-prevention-toolkit.js detect app/pages/home.tsx
```

#### 检查翻译键完整性
```bash
# 检查翻译键完整性
node scripts/hardcode-prevention-toolkit.js check-keys

# 生成页面模板
node scripts/hardcode-prevention-toolkit.js generate-template naturalTherapies
```

## 🔧 开发工作流

### 新功能开发时

#### 1. 使用URL配置
```typescript
// ✅ 正确做法
import { URL_CONFIG } from '@/lib/url-config';

// 生成规范URL
const canonicalUrl = URL_CONFIG.getCanonicalUrl('/natural-therapies');

// 生成Open Graph图片URL
const ogImageUrl = URL_CONFIG.getOgImageUrl('/natural-therapies.jpg');

// 生成API URL
const apiUrl = URL_CONFIG.getApiUrl('/articles');
```

#### 2. 使用翻译键
```typescript
// ✅ 正确做法
import { useTranslations } from 'next-intl';

const t = useTranslations('naturalTherapies');
return <h1>{t('hero.title')}</h1>;
```

#### 3. 提交前检查
```bash
# 运行完整检查
npm run hardcode:all

# 如果发现问题，先修复再提交
npm run hardcode:fix
```

### 发现硬编码时

#### 1. 立即停止开发
```bash
# 不要继续开发，先解决问题
```

#### 2. 运行检测确认问题
```bash
# 确认问题范围
npm run hardcode:all
```

#### 3. 安全修复
```bash
# 使用自动化工具修复
npm run hardcode:fix

# 验证修复结果
npm run hardcode:verify
```

#### 4. 继续开发
```bash
# 确保没有新硬编码后继续
npm run hardcode:all
```

## 📊 监控和维护

### 日常监控
```bash
# 每日检查
npm run hardcode:all

# 每周深度检查
npm run hardcode:all && npm run build
```

### 团队协作
```bash
# 提交前自动检查（已配置Git Hook）
git add .
git commit -m "feat: 新功能"
# Git Hook会自动运行检查
```

### 性能监控
```bash
# 检查性能影响
npm run test:performance
```

## ⚠️ 注意事项

### 禁止的做法
```typescript
// ❌ 禁止 - 硬编码URL
const url = 'https://periodhub.health/articles';

// ❌ 禁止 - 硬编码文本
const title = '自然疗法指南';

// ❌ 禁止 - 条件硬编码
{locale === 'zh' ? '中文' : 'English'}
```

### 推荐的做法
```typescript
// ✅ 推荐 - 使用URL配置
const url = URL_CONFIG.getUrl('/articles');

// ✅ 推荐 - 使用翻译键
const title = t('naturalTherapies.title');

// ✅ 推荐 - 使用翻译函数
{t('common.welcome')}
```

## 🆘 故障排除

### 常见问题

#### 1. 检测脚本报错
```bash
# 检查Node.js版本
node --version  # 需要 >= 20.0.0

# 检查文件权限
chmod +x scripts/*.js
```

#### 2. 修复失败
```bash
# 检查备份文件
ls -la *.backup

# 手动回滚
cp file.tsx.backup file.tsx
```

#### 3. Git Hook不工作
```bash
# 检查Hook文件权限
chmod +x .git/hooks/pre-commit

# 手动运行检查
.git/hooks/pre-commit
```

### 获取帮助
```bash
# 查看工具帮助
node scripts/hardcode-prevention-toolkit.js help
node scripts/detect-hardcoded-urls.js --help
```

## 📈 进阶使用

### 自定义检测规则
```typescript
// 在 scripts/hardcode-prevention-toolkit.js 中添加自定义规则
const customPatterns = [
  {
    pattern: /your-custom-pattern/g,
    type: 'custom-type',
    severity: 'high',
    description: '自定义硬编码检测'
  }
];
```

### 集成到CI/CD
```yaml
# .github/workflows/hardcode-check.yml
name: 硬编码检查
on: [push, pull_request]
jobs:
  hardcode-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: 安装依赖
        run: npm install
      - name: 检查硬编码
        run: npm run hardcode:all
      - name: 自动修复
        run: npm run hardcode:fix
        continue-on-error: true
      - name: 验证修复
        run: npm run hardcode:verify
```

## 🎉 总结

通过遵循这个快速开始指南，您可以：

1. **快速上手** - 了解基本使用方法
2. **安全修复** - 使用自动化工具避免错误
3. **持续监控** - 建立日常检查习惯
4. **团队协作** - 确保代码质量一致性

记住：**预防为主，检测为辅，修复为补**！ 🛡️
